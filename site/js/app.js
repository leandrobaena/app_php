Ext.define("susencargos.model.Zone",{extend:"Ext.data.Model",fields:[{name:"idzone",type:"int"},{name:"name",type:"string"}]}),Ext.define("susencargos.model.Customer",{extend:"Ext.data.Model",fields:[{name:"idcustomer",type:"int"},{name:"name",type:"string"},{name:"taxid",type:"string"},{name:"address",type:"string"},{name:"phone",type:"string"},{name:"city",reference:"susencargos.model.City"},{name:"user",reference:"susencargos.model.User"},{name:"contact",type:"string"}]}),Ext.define("susencargos.model.City",{extend:"Ext.data.Model",fields:[{name:"idcity",type:"int"},{name:"name",type:"string"},{name:"zone",reference:"susencargos.model.Zone"}]}),Ext.define("susencargos.model.StateTracking",{extend:"Ext.data.Model",fields:[{name:"idstatetracking",type:"int"},{name:"name",type:"string"}]}),Ext.define("susencargos.model.Package",{extend:"Ext.data.Model",fields:[{name:"idpackage",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d"},{name:"citySource",reference:"susencargos.model.City"},{name:"cityDestination",reference:"susencargos.model.City"},{name:"customer",reference:"susencargos.model.Customer"},{name:"nameTo",type:"string"},{name:"addressTo",type:"string"},{name:"phoneTo",type:"string"},{name:"content",type:"string"},{name:"observations",type:"string"},{name:"weight",type:"float"},{name:"volumen",type:"float"},{name:"amount",type:"int"},{name:"declaredValue",type:"float"},{name:"shippingValue",type:"float"},{name:"managementValue",type:"float"},{name:"totalValue",type:"float"},{name:"reference",type:"string"},{name:"payType",reference:"susencargos.model.PayType"}]}),Ext.define("susencargos.model.PayType",{extend:"Ext.data.Model",fields:[{name:"idpaytype",type:"int"},{name:"name",type:"string"}]}),Ext.define("susencargos.model.Tracking",{extend:"Ext.data.Model",fields:[{name:"idtracking",type:"int"},{name:"date",type:"date",dateFormat:"Y-m-d H:i:s"},{name:"package",reference:"susencargos.model.Package"},{name:"state",reference:"susencargos.model.StateTracking"}]}),Ext.define("susencargos.model.PackageType",{extend:"Ext.data.Model",fields:[{name:"idpackagetype",type:"int"},{name:"name",type:"string"}]}),Ext.define("susencargos.store.MainStore",{extend:"Ext.data.Store",object:"",autoLoad:!0,proxy:{type:"ajax",url:"intranet/stores/list_objects.php",extraParams:{object:""},reader:{type:"json",root:"data",successProperty:"success"}},constructor:function(e){e=Ext.apply({proxy:{extraParams:{object:e.object}}},e),this.callParent([e])},listeners:{load:function(e,t,a){a||Ext.MessageBox.show({title:"Error",msg:"Sesión expirada",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})}}}),Ext.Loader.setConfig({enabled:!0}),Ext.create("Ext.app.Controller",{control:{"listPackages button[action=insert]":{click:"insert"},"listPackages button[action=clean]":{click:"cleanFilters"},"listPackages actioncolumn[action=tracking]":{click:"tracking"},"listPackages actioncolumn[action=rotules]":{click:"rotules"},"listPackages actioncolumn[action=label]":{click:"label"},"formPackage combo[name=idpackagetype]":{select:"changePackageType"},"formPackage button[action=cancel]":{click:"cancel"},"formPackage button[action=save]":{click:"save"}},insert:function(){Ext.getStore("City").load({params:{start:0,limit:1e3},callback:function(){Ext.widget("formPackage").down("form").loadRecord(Ext.create("susencargos.model.Package"))}})},cancel:function(e){e.up("window").close()},cleanFilters:function(e){e.up("grid").filters.clearFilters(),Ext.getStore("Package").load()},changePackageType:function(e,t){var a=e.up("window").down("form").getForm();a.findField("weight").setValue(1==t[0].get("idpackagetype")?30:1)},tracking:function(e,t,a){window.open("seguimiento.php?tracking="+e.getStore().getAt(a).get("idpackage"))},save:function(e){e.up("form").getForm().isValid()?(e.up("form").getForm().findField("id").setValue(e.up("form").getForm().findField("idpackage").getValue()),e.up("form").getForm().submit({waitMsg:"Guardando ...",success:function(t,a){var n=Ext.JSON.decode(a.response.responseText);Ext.MessageBox.show({title:n.msg.title,msg:n.msg.body,buttons:Ext.Msg.OK,icon:Ext.Msg.INFO,fn:function(){Ext.getStore("Package").load()}}),e.up("window").close()},failure:function(t,a){var n=Ext.JSON.decode(a.response.responseText);Ext.MessageBox.show({title:n.msg.title,msg:n.msg.body,buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR}),e.up("window").close()}})):Ext.MessageBox.show({title:"Error",msg:"Ingrese los datos correctos",buttons:Ext.Msg.OK,icon:Ext.Msg.ERROR})},rotules:function(e,t,a){window.open("intranet/rotules.php?id="+e.getStore().getAt(a).get("idpackage"))},label:function(e,t,a){window.open("intranet/label.php?id="+e.getStore().getAt(a).get("idpackage"))}}),Ext.application({requires:["Ext.container.Viewport"],name:"susencargos",launch:function(){Ext.create("susencargos.store.MainStore",{storeId:"Package",model:"susencargos.model.Package",object:"packagesCustomer"}),Ext.create("susencargos.store.MainStore",{storeId:"Tracking",model:"susencargos.model.Tracking",object:"trackings",autoLoad:!1}),Ext.create("susencargos.store.MainStore",{storeId:"PayType",model:"susencargos.model.PayType",object:"payTypes"}),Ext.create("susencargos.store.MainStore",{storeId:"PackageType",model:"susencargos.model.PackageType",object:"packageTypes"}),Ext.create("susencargos.store.MainStore",{storeId:"City",model:"susencargos.model.City",object:"cities"}),Ext.define("susencargos.view.MainGrid",{extend:"Ext.grid.Panel",alias:"",plugins:{ptype:"gridfilters",menuFilterText:"Filtros"},layout:"fit",closable:!0,autoScroll:!0,buttonsAds:[],viewConfig:{enableTextSelection:!0},constructor:function(e){this.callParent(e)}}),Ext.define("susencargos.view.MainForm",{extend:"Ext.window.Window",iconCls:"edit",width:600,maximizable:!0,object:"",fields:[],buttons:[],modal:!0,layout:"fit",autoShow:!0,items:[{xtype:"form",autoScroll:!0,url:"intranet/update/save_object.php",defaults:{labelAlign:"right"}}],initComponent:function(){this.items[0].items=[{xtype:"hiddenfield",name:"id",value:""},{xtype:"hiddenfield",name:"object",value:this.object},{xtype:"panel",html:"* Campos obligatorios",border:0,padding:10}].concat(this.fields),this.items[0].buttons=this.buttons,this.buttons=null,this.callParent()}}),Ext.define("susencargos.view.package.Grid",{extend:"susencargos.view.MainGrid",iconCls:"package",alias:"widget.listPackages",renderTo:"listPackages",closable:!1,title:"Listado remesas",store:"Package",columns:[{header:"Número",filter:"number",dataIndex:"idpackage",flex:1},{header:"Fecha",dataIndex:"date",filter:{type:"date",fields:{lt:{text:"Antes de"},gt:{text:"Depués de "},eq:{text:"El día"}},dateFormat:"Y-m-d"},flex:2,renderer:Ext.util.Format.dateRenderer("Y-m-d")},{header:"Origen",dataIndex:"citySource",flex:2,renderer:function(e){return e.name}},{header:"Destino",dataIndex:"cityDestination",flex:2,renderer:function(e){return e.name}},{header:"Destinatario",dataIndex:"nameTo",flex:2},{header:"Dirección",dataIndex:"addressTo",flex:2},{header:"Peso",dataIndex:"weight",flex:1},{header:"Cantidad",dataIndex:"amount",flex:1},{header:"Valor declarado",dataIndex:"declaredValue",flex:1},{xtype:"actioncolumn",width:20,action:"tracking",tooltip:"Seguimiento",icon:"intranet/css/tracking.png",stopSelection:!1,iconCls:"rotule"},{xtype:"actioncolumn",width:20,action:"rotules",tooltip:"Imprimir rótulos",icon:"intranet/css/rotule.png",stopSelection:!1,iconCls:"rotule"},{xtype:"actioncolumn",width:20,action:"label",tooltip:"Imprimir etiqueta",icon:"intranet/css/label.png",stopSelection:!1,iconCls:"label"}],bbar:{xtype:"pagingtoolbar",pageSize:25,store:"Package",displayInfo:!0,items:[{xtype:"button",icon:"intranet/css/insert.png",text:"Nueva remesa",tooltip:"Nuev remesa",action:"insert"}]}}),Ext.define("susencargos.view.package.Form",{extend:"susencargos.view.MainForm",alias:"widget.formPackage",title:"Insertar nueva remesa",object:"packagesCustomer",fields:[{xtype:"container",layout:{type:"table",columns:2},defaults:{layout:"anchor",anchor:"100%",style:"margin: 3px; padding:3px;"},items:[{xtype:"hiddenfield",name:"idpackage",value:0},{xtype:"datefield",name:"date",value:"",allowBlank:!1,anchor:"90%",fieldLabel:"* Fecha del envío",format:"Y-m-d"},{xtype:"combo",fieldLabel:"* Tipo de pago",store:"PayType",typeAhead:!0,forceSelection:!0,allowBlank:!1,valueField:"idpaytype",displayField:"name",name:"idpaytype",anchor:"90%",queryMode:"local"},{xtype:"combo",fieldLabel:"* Tipo de envío",store:"PackageType",typeAhead:!0,forceSelection:!0,allowBlank:!1,valueField:"idpackagetype",displayField:"name",name:"idpackagetype",anchor:"90%",queryMode:"local"},{xtype:"combo",fieldLabel:"* Ciudad destino",store:"City",typeAhead:!0,forceSelection:!0,allowBlank:!1,valueField:"idcity",displayField:"name",name:"idcitydestination",anchor:"90%",queryMode:"local"},{xtype:"textfield",name:"nameTo",value:"",allowBlank:!1,anchor:"90%",fieldLabel:"* Nombre destinatario"},{xtype:"textfield",name:"addressTo",value:"",allowBlank:!1,anchor:"90%",fieldLabel:"* Dirección destinatario"},{xtype:"textfield",name:"phoneTo",value:"",anchor:"90%",fieldLabel:"Teléfono destinatario"},{xtype:"textfield",name:"content",value:"",anchor:"90%",fieldLabel:"Dice contener"},{xtype:"textfield",name:"observations",value:"",anchor:"90%",fieldLabel:"Observaciones"},{xtype:"numberfield",hideTrigger:!0,name:"weight",value:0,anchor:"90%",fieldLabel:"Peso"},{xtype:"numberfield",hideTrigger:!0,name:"volumen",value:0,anchor:"90%",fieldLabel:"Volumen"},{xtype:"numberfield",hideTrigger:!0,name:"amount",allowBlank:!1,value:1,anchor:"90%",fieldLabel:"* Cantidad"},{xtype:"numberfield",hideTrigger:!0,name:"declaredValue",allowBlank:!1,value:4e5,anchor:"90%",fieldLabel:"* Valor declarado"},{xtype:"textfield",name:"reference",value:"",anchor:"90%",fieldLabel:"Referencia"}]}],buttons:[{text:"Guardar",action:"save"},{text:"Cancelar",action:"cancel"}]}),Ext.define("susencargos.view.package.Tracking",{extend:"susencargos.view.MainGrid",iconCls:"tracking",alias:"widget.listTrackings",renderTo:"trackingsPackage",title:"Seguimiento",store:"Tracking",columns:[{header:"ID",filter:"number",dataIndex:"idtracking",flex:1},{header:"Fecha",dataIndex:"date",filter:{type:"date",fields:{lt:{text:"Antes de"},gt:{text:"Depués de "},eq:{text:"El día"}},dateFormat:"Y-m-d H:i:s"},flex:2,renderer:Ext.util.Format.dateRenderer("Y-m-d H:i:s")},{header:"Estado",dataIndex:"state",flex:2,renderer:function(e){return e.name}}]}),Ext.widget("listPackages")}});